function createWorld() {
    // 1. 실제 아스팔트 도로망 생성 (100x100 격자)
    const worldSize = 500;
    const planeGeo = new THREE.PlaneGeometry(worldSize, worldSize);
    const planeMat = new THREE.MeshStandardMaterial({ color: 0x222222 }); // 진한 회색 도로
    const floor = new THREE.Mesh(planeGeo, planeMat);
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    // 도로 차선 (흰색 점선)
    const grid = new THREE.GridHelper(worldSize, 20, 0xffffff, 0x444444);
    grid.position.y = 0.05;
    scene.add(grid);

    // 2. 아파트 단지 배치 (구역별로 촘촘하게)
    for (let x = -2; x <= 2; x++) {
        for (let z = -2; z <= 2; z++) {
            if (x === 0 && z === 0) continue; // 중앙은 광장으로 비움
            spawnComplex(x * 60, z * 60);
        }
    }

    // 3. 광장 및 가로등
    const plaza = new THREE.Mesh(new THREE.CircleGeometry(20, 32), new THREE.MeshStandardMaterial({color: 0x555555}));
    plaza.rotation.x = -Math.PI/2;
    plaza.position.y = 0.1;
    scene.add(plaza);
}

function spawnComplex(x, z) {
    // 한 구역에 아파트 3개씩 배치
    for(let i=0; i<3; i++) {
        const offset = i * 15;
        const height = 20 + Math.random() * 30;
        createApartment(x + offset, z + offset, height);
    }
}

function createApartment(x, z, h) {
    const aptGroup = new THREE.Group();

    // 건물 외골격 (실제 들어갈 수 있게 투명도 조절 또는 구멍 뚫기)
    const body = new THREE.Mesh(
        new THREE.BoxGeometry(12, h, 12),
        new THREE.MeshStandardMaterial({ color: 0x777777, wireframe: false, opacity: 0.9, transparent: true })
    );
    body.position.y = h / 2;
    aptGroup.add(body);

    // 층별 바닥 (내부 탐험용)
    for (let f = 1; f < h / 4; f++) {
        const floor = new THREE.Mesh(
            new THREE.BoxGeometry(11.8, 0.2, 11.8),
            new THREE.MeshStandardMaterial({ color: 0x444444 })
        );
        floor.position.y = f * 4;
        aptGroup.add(floor);
        
        // 창문 (빛나는 파란색)
        const windowGeo = new THREE.PlaneGeometry(1, 1);
        const windowMat = new THREE.MeshBasicMaterial({color: 0x00ffff});
        const win = new THREE.Mesh(windowGeo, windowMat);
        win.position.set(6.1, f * 4 + 1.5, 0);
        win.rotation.y = Math.PI/2;
        aptGroup.add(win);
    }

    // 1층 입구 뚫기 (실제 캐릭터가 들어가는 곳)
    const entrance = new THREE.Mesh(
        new THREE.BoxGeometry(4, 5, 2),
        new THREE.MeshBasicMaterial({ color: 0x000000 })
    );
    entrance.position.set(0, 2.5, 6.1);
    aptGroup.add(entrance);

    aptGroup.position.set(x, 0, z);
    scene.add(aptGroup);
}
